{% extends 'base.html' %}
{% block title %} {{t}} {% endblock %}
{% block styles %}
<link rel="stylesheet" href="https://cdn.datatables.net/2.0.2/css/dataTables.dataTables.css" />
{% endblock styles %}
{% block content %}

<main class="container">
    <h1>All Expenses</h1>
    <div>

        <table class="table" id="example" class="display" >
        <form method="POST" action="{% url 'expense' %}">
            {% csrf_token %}
            <thead>
                <tr>
                    <th>categories</th>
                    <th>Description</th>
                    <th>Amount</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>

                <tr>
                    {% if not forms.instance.id %}
                      {% include 'saveexpense.html' %}
                    {% endif %}
                  </tr>

                {% for a in expense %}

                <tr>
                    {% if forms.instance.id == a.id %}
                    {% include 'saveexpense.html' %}
                {% else %}
      


                    <td>{{ a.categories }}</td>
                    <td>{{ a.description }}</td>
                    <td>{{ a.amount }}</td>
                    <td>{{ a.date}}</td>
                    <td>
            <button formnovalidate name="edit" value="{{a.id}}" class="btn btn-sm btn-warning">Edit</button>
            <button formnovalidate onclick=" return confirm('do you want to delete?')" 
            name="delete" value="{{a.id}}" class="btn btn-sm btn-danger">Delete</button>
          </td>
          {% endif%}

                </tr>
                {% endfor %}
            </tbody>
        </form>
        </table>
    </div>
</main>
{% endblock %}
{% block script %}
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdn.datatables.net/2.0.2/js/dataTables.js"></script>
<script>
    var table = new DataTable('#example');
    $('#submit').on('click', function (e) {
        var form = table.$('input').serialize();
        var actionUrl = {% url 'expense' %};
        
        $.ajax({
            type: "POST",
            url: actionUrl,
            data: {
                form, // serializes the form's elements.
                'csrfmiddlewaretoken':$( "input[name='csrfmiddlewaretoken']" ).val()
            },
            success: function(data)
            {
              alert('Success'); // show response from the php script.
            }
        });
    });
</script>
{% endblock%}
